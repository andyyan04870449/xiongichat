#!/usr/bin/env python3
"""收集毒防知識資料"""

import asyncio
import sys
import os
from pathlib import Path

# 添加專案根目錄到 Python 路徑
sys.path.append(str(Path(__file__).parent.parent))

from app.services.knowledge_manager import KnowledgeManager

# 毒防知識資料
KNOWLEDGE_DATA = [
    {
        "title": "高雄市毒品危害防制中心服務項目",
        "content": """
高雄市毒品危害防制中心提供以下服務：

1. 個案管理服務
   - 提供個案評估與輔導
   - 協助制定個人復健計畫
   - 定期追蹤輔導進度

2. 醫療轉介服務
   - 美沙冬替代療法
   - 丁基原啡因治療
   - 心理諮商轉介

3. 就業輔導服務
   - 職業技能訓練
   - 就業媒合服務
   - 職場適應輔導

4. 家庭支持服務
   - 家庭諮商
   - 親職教育
   - 家庭關係修復

5. 法律諮詢服務
   - 毒品相關法律問題諮詢
   - 司法程序協助
   - 權益保護宣導

服務時間：週一至週五 08:00-17:00
聯絡電話：07-251-0000
地址：高雄市前金區中正四路211號
        """,
        "source": "高雄市毒品危害防制中心",
        "category": "services",
        "lang": "zh-TW"
    },
    {
        "title": "美沙冬替代療法說明",
        "content": """
美沙冬替代療法是一種有效的藥物成癮治療方法：

1. 治療原理
   - 美沙冬是一種長效的合成鴉片類藥物
   - 可以減少對海洛因等短效藥物的渴求
   - 穩定患者的情緒和生理狀態

2. 治療流程
   - 初次評估：醫師評估患者狀況
   - 劑量調整：根據個人需求調整劑量
   - 定期回診：監控治療效果和副作用
   - 維持治療：長期穩定服用

3. 注意事項
   - 必須在指定醫療院所服用
   - 不得將藥物帶離醫療院所
   - 定期接受尿液檢測
   - 配合心理輔導和社會支持

4. 治療效果
   - 減少非法藥物使用
   - 降低犯罪率
   - 改善健康狀況
   - 提升生活品質

高雄市提供美沙冬治療的醫療院所：
- 高雄榮民總醫院
- 高雄醫學大學附設醫院
- 高雄市立聯合醫院
        """,
        "source": "高雄市衛生局",
        "category": "medical",
        "lang": "zh-TW"
    },
    {
        "title": "毒品危害防制條例相關規定",
        "content": """
毒品危害防制條例是台灣主要的毒品管制法律：

1. 毒品分類
   - 第一級：海洛因、嗎啡、鴉片等
   - 第二級：安非他命、大麻、搖頭丸等
   - 第三級：K他命、FM2等
   - 第四級：其他管制藥物

2. 持有毒品刑責
   - 第一級：處3年以上10年以下有期徒刑
   - 第二級：處2年以上5年以下有期徒刑
   - 第三級：處1年以上3年以下有期徒刑
   - 第四級：處1年以下有期徒刑

3. 販賣毒品刑責
   - 第一級：處死刑或無期徒刑
   - 第二級：處無期徒刑或7年以上有期徒刑
   - 第三級：處7年以上有期徒刑
   - 第四級：處5年以上12年以下有期徒刑

4. 自首減刑
   - 主動向司法機關自首
   - 供出毒品來源
   - 協助查獲其他犯罪
   - 可獲得減刑或免刑

5. 緩起訴與戒癮治療
   - 初犯或輕微案件可申請緩起訴
   - 配合戒癮治療可避免刑事處罰
   - 完成治療後可撤銷起訴

重要提醒：毒品對個人、家庭和社會都會造成嚴重危害，請遠離毒品，如有成癮問題請尋求專業協助。
        """,
        "source": "法務部",
        "category": "legal",
        "lang": "zh-TW"
    },
    {
        "title": "常見毒品成癮症狀與戒斷反應",
        "content": """
了解毒品成癮症狀和戒斷反應有助於早期發現和治療：

1. 海洛因成癮症狀
   - 生理症狀：瞳孔縮小、呼吸緩慢、便秘
   - 心理症狀：情緒不穩、焦慮、憂鬱
   - 行為症狀：說謊、偷竊、社交孤立

2. 安非他命成癮症狀
   - 生理症狀：心跳加速、血壓升高、失眠
   - 心理症狀：妄想、幻覺、攻擊性行為
   - 行為症狀：多話、活動過度、食慾不振

3. 戒斷反應
   - 海洛因戒斷：流淚、流鼻水、肌肉疼痛、腹瀉
   - 安非他命戒斷：疲勞、憂鬱、食慾增加、睡眠過多
   - 一般戒斷：焦慮、易怒、注意力不集中

4. 戒斷期程
   - 急性期：1-2週，症狀最嚴重
   - 亞急性期：2-4週，症狀逐漸緩解
   - 恢復期：數月至數年，需要持續支持

5. 治療建議
   - 尋求專業醫療協助
   - 配合藥物治療
   - 接受心理輔導
   - 建立支持網絡
   - 改變生活環境

6. 家人支持
   - 了解成癮是疾病
   - 提供情感支持
   - 設定合理界限
   - 尋求專業協助
   - 照顧自己身心健康

戒癮是一個長期過程，需要耐心和持續的努力。
        """,
        "source": "衛生福利部",
        "category": "medical",
        "lang": "zh-TW"
    },
    {
        "title": "高雄市毒品危害防制中心常見問題",
        "content": """
以下是民眾常詢問的問題：

Q1: 如何申請毒品危害防制中心的服務？
A1: 可以親自到中心申請，或透過醫療院所、司法機關轉介。申請時需要攜帶身分證件和相關證明文件。

Q2: 服務是否收費？
A2: 大部分服務都是免費的，包括個案管理、諮商輔導、就業媒合等。醫療服務可能需要部分負擔。

Q3: 資料會保密嗎？
A3: 是的，所有個案資料都受到法律保護，工作人員有保密義務，不會洩露個案隱私。

Q4: 可以匿名諮詢嗎？
A4: 可以，中心提供匿名諮詢服務，但如需進一步協助，建議提供真實資料以便追蹤。

Q5: 家人可以一起參與治療嗎？
A5: 可以，中心鼓勵家人參與治療過程，提供家庭諮商和親職教育服務。

Q6: 治療需要多長時間？
A6: 治療時間因人而異，通常需要數月至數年。重要的是持續參與和配合治療計畫。

Q7: 如果復發怎麼辦？
A7: 復發是戒癮過程中的常見現象，不要放棄。中心會調整治療計畫，提供更強化的支持。

Q8: 如何聯絡中心？
A8: 電話：07-251-0000，地址：高雄市前金區中正四路211號，服務時間：週一至週五 08:00-17:00。

Q9: 有其他求助管道嗎？
A9: 可以撥打24小時安心專線1925，或向就近的醫療院所、社會福利機構求助。

Q10: 如何預防家人吸毒？
A10: 建立良好的親子關係，關注家人生活狀況，提供正確的毒品危害資訊，營造無毒的家庭環境。
        """,
        "source": "高雄市毒品危害防制中心",
        "category": "faq",
        "lang": "zh-TW"
    },
    {
        "title": "毒品對身體健康的危害",
        "content": """
毒品對人體各系統都會造成嚴重危害：

1. 神經系統危害
   - 海洛因：抑制中樞神經，可能導致呼吸停止
   - 安非他命：過度刺激神經，可能導致中風或心臟病
   - 大麻：影響記憶力和判斷力
   - K他命：損害膀胱和腎臟功能

2. 心血管系統危害
   - 心跳不規律
   - 血壓異常
   - 心臟病發作
   - 中風風險增加

3. 呼吸系統危害
   - 呼吸抑制
   - 肺炎風險增加
   - 肺水腫
   - 呼吸衰竭

4. 消化系統危害
   - 食慾不振
   - 營養不良
   - 肝臟損害
   - 胃腸道問題

5. 免疫系統危害
   - 抵抗力下降
   - 感染風險增加
   - 傷口癒合緩慢
   - 疾病恢復困難

6. 精神健康危害
   - 憂鬱症
   - 焦慮症
   - 精神病症狀
   - 自殺風險增加

7. 社會功能危害
   - 工作能力下降
   - 人際關係惡化
   - 經濟困難
   - 犯罪行為增加

8. 懷孕期間危害
   - 胎兒發育異常
   - 早產風險
   - 新生兒戒斷症候群
   - 長期發展問題

9. 傳染病風險
   - 共用針具導致肝炎、愛滋病
   - 不安全性行為
   - 免疫力下降增加感染風險

10. 預防措施
    - 遠離毒品
    - 建立健康生活方式
    - 尋求專業協助
    - 建立支持網絡

記住：毒品沒有安全的使用量，任何使用都可能造成危害。
        """,
        "source": "衛生福利部",
        "category": "medical",
        "lang": "zh-TW"
    }
]


async def main():
    """主函數"""
    print("開始收集毒防知識資料...")
    
    knowledge_manager = KnowledgeManager()
    
    try:
        # 批量添加知識資料
        document_ids = await knowledge_manager.bulk_add_documents(KNOWLEDGE_DATA)
        
        print(f"成功添加 {len(document_ids)} 個知識文件")
        
        # 顯示統計資訊
        stats = await knowledge_manager.get_statistics()
        print("\n知識庫統計資訊：")
        print(f"總文件數：{stats['total_documents']}")
        print(f"總嵌入數：{stats['total_embeddings']}")
        print(f"類別統計：{stats['category_stats']}")
        print(f"語言統計：{stats['lang_stats']}")
        
        # 測試搜尋功能
        print("\n測試搜尋功能...")
        search_results = await knowledge_manager.search_documents("美沙冬治療", k=3)
        print(f"搜尋 '美沙冬治療' 找到 {len(search_results)} 個結果")
        
        for i, result in enumerate(search_results, 1):
            print(f"{i}. {result['title']} (相似度: {result['similarity_score']:.3f})")
        
        print("\n知識資料收集完成！")
        
    except Exception as e:
        print(f"錯誤：{str(e)}")
        raise


if __name__ == "__main__":
    asyncio.run(main())
